<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Notices Table from XLSX</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    table.dataTable thead {
      background-color: #3e6651;
      color: #ffffff;
    }
    table.dataTable th,
    table.dataTable td {
      padding: 10px;
    }
    table.dataTable tbody tr:nth-child(odd) {
      background-color: #fafafa;
    }
    table.dataTable tbody tr:nth-child(even) {
      background-color: #ffffff;
    }
    table.dataTable {
      width: 100%;
      border-collapse: collapse;
    }
  </style>
</head>
<body>
  <h1>Notices Table (XLSX)</h1>
  <div id="data-container">Loading data...</div>

  <!-- Include jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- Include SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <!-- Include DataTables -->
  <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
  
  <script>
    // Helper function to convert an Excel serial date to a JavaScript date.
    function excelDateToJSDate(serial) {
      // Excel's epoch (for Windows) is 25569 days after 1899-12-30.
      var utc_days  = Math.floor(serial - 25569);
      var utc_value = utc_days * 86400; // seconds in a day
      var date_info = new Date(utc_value * 1000);
      return date_info;
    }

    $(document).ready(function() {
      // Reference the XLSX file (it should be in the same directory as index.html)
      var xlsxUrl = 'WARN_Scrapes.xlsx';

      // Fetch the XLSX file using jQuery's AJAX method
      $.ajax({
        url: xlsxUrl,
        method: 'GET',
        xhrFields: {
          responseType: 'arraybuffer'
        },
        success: function(data) {
          // Parse the XLSX data using SheetJS
          var workbook = XLSX.read(data, { type: 'array' });
          // Use the first sheet (adjust if necessary)
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          // Convert the sheet to JSON; header: 1 returns an array-of-arrays
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          
          if (jsonData.length === 0) {
            $('#data-container').html('No data found in XLSX.');
            return;
          }
          
          // Assume the first row contains headers
          var headers = jsonData[0];
          var rows = jsonData.slice(1);
          
          // Build an HTML table using the headers and data rows
          var tableHtml = '<table id="xlsxTable" class="display"><thead><tr>';
          headers.forEach(function(header) {
            tableHtml += '<th>' + header + '</th>';
          });
          tableHtml += '</tr></thead><tbody>';
          
          // Build table rows and check for a "Date Posted" column for conversion
          rows.forEach(function(row) {
            tableHtml += '<tr>';
            headers.forEach(function(col, idx) {
              var cellVal = row[idx] || '';
              if(col === "Date Posted" && typeof cellVal === 'number'){
                var dateObj = excelDateToJSDate(cellVal);
                cellVal = dateObj.toLocaleDateString();
              }
              tableHtml += '<td>' + cellVal + '</td>';
            });
            tableHtml += '</tr>';
          });
          tableHtml += '</tbody></table>';
          
          // Insert the table into the page
          $('#data-container').html(tableHtml);
          // Initialize DataTables for interactivity
          $('#xlsxTable').DataTable();
        },
        error: function(err) {
          console.error('Error fetching XLSX file:', err);
          $('#data-container').html('Error loading the XLSX file.');
        }
      });
    });
  </script>
</body>
</html>
